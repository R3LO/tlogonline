<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO</h1>
        
        <button type="button" class="btn btn-sm btn-outline-info view-qso-btn" 
                data-qso-id="test-id-123" title="–ü—Ä–æ—Å–º–æ—Ç—Ä QSO">
            <span>üëÅÔ∏è</span>
        </button>
        
        <div id="status" class="mt-3 alert alert-info">
            –°—Ç–∞—Ç—É—Å: –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal fade" id="viewQSOModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ QSO</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>–¢–µ—Å—Ç–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ</p>
                    <div id="test-content">
                        <strong>ID:</strong> <span id="view_id">test</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        console.log('=== DEBUG TEST STARTED ===');
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = '–°—Ç–∞—Ç—É—Å: ' + message;
            console.log('STATUS:', message);
        }
        
        function getCsrfToken() {
            return 'debug-token';
        }
        
        async function loadQSODetails(qsoId) {
            console.log('loadQSODetails called with ID:', qsoId);
            updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ID: ' + qsoId);
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º API –æ—Ç–≤–µ—Ç
            setTimeout(() => {
                populateViewModal({
                    id: qsoId,
                    callsign: 'TEST_CALL',
                    date: '2024-01-01',
                    time: '12:00:00'
                });
                
                updateStatus('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                
                const modalElement = document.getElementById('viewQSOModal');
                console.log('Modal element found:', modalElement);
                
                if (modalElement) {
                    const modal = new bootstrap.Modal(modalElement);
                    modal.show();
                    updateStatus('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ!');
                } else {
                    updateStatus('–û–®–ò–ë–ö–ê: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
                }
            }, 1000);
        }
        
        function populateViewModal(qsoData) {
            console.log('populateViewModal called with data:', qsoData);
            document.getElementById('view_id').value = qsoData.id;
        }
        
        function initQSOView() {
            console.log('initQSOView called');
            const viewButtons = document.querySelectorAll('.view-qso-btn');
            console.log('Found buttons:', viewButtons.length);
            
            viewButtons.forEach((button, index) => {
                console.log('Adding click handler to button', index);
                button.addEventListener('click', function(e) {
                    console.log('Button clicked!');
                    e.preventDefault();
                    const qsoId = this.getAttribute('data-qso-id');
                    console.log('QSO ID from button:', qsoId);
                    if (qsoId) {
                        loadQSODetails(qsoId);
                    } else {
                        console.error('No QSO ID found!');
                        updateStatus('–û–®–ò–ë–ö–ê: ID –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            updateStatus('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏...');
            initQSOView();
            updateStatus('–ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É');
        });
        
        console.log('=== DEBUG TEST SCRIPT LOADED ===');
    </script>
</body>
</html>