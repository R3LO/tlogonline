# TLog Search

Компактное десктопное приложение на Python с PySide6 для поиска QSO в логбуке TLog через REST API.

## Особенности

- **Компактный интерфейс** — окно занимает минимум места на экране (700x500 минимальный размер)
- **Быстрый поиск** — основной функционал — поиск по части позывного и QTH локатору
- **Удобный повторный поиск** — поле ввода в фокусе, Enter для поиска
- **Статус подключения** — индикатор в строке состояния (зелёный — подключено, красный — нет)
- **Автоподключение** — автоматическое подключение при запуске с сохранёнными данными
- **Локальная база данных** — все QSO сохраняются в SQLite для быстрой работы
- **Синхронизация** — автоматическая загрузка новых QSO при подключении
- **Меню настроек** — все настройки подключения в меню Файл

## Архитектура приложения

Приложение разбито на модули для лучшей читаемости и поддержки:

- **main.py** — точка входа в приложение
- **main_window.py** — главное окно с основной логикой приложения
- **qso_dialog.py** — диалог создания/редактирования QSO
- **tabs.py** — виджеты вкладок (Поиск, LoTW, QSO, Статистика, Профиль)
- **tables.py** — настройка и заполнение таблиц QSO
- **workers.py** — worker потоки для асинхронных операций
- **api_client.py** — REST API клиент для работы с сервером
- **settings.py** — управление настройками приложения
- **database.py** — локальная база данных SQLite для хранения QSO

## Возможности

### Поиск QSO (основная вкладка)
- **По позывному** — поиск по части позывного (напр. "UA")
- **По QTH локатору** — поиск по части локатора (напр. "KO")
- **По диапазону** — поиск по диапазону (напр. "20M")
- Компактная таблица результатов (8 колонок)
- Сортировка по дате (от новых к старым)
- Колонка LoTW с зелёной галочкой ✓ для подтверждённых QSO
- Горячая клавиша Enter для быстрого поиска

### LoTW вкладка
- QSO подтверждённые через LoTW (только lotw='Y')
- Сортировка по дате получения подтверждения (app_lotw_rxqsl)
- Поиск по позывному с фильтрацией только LoTW QSO
- Таблица содержит: Дата QSO, Позывной, Диапазон, Режим, DXCC, QTH, **LoTW дата**, CQ, ITU
- Редактирование и удаление QSO
- Автоматическая загрузка при подключении

### QSO вкладка
- Полный список всех QSO с подробной информацией
- Создание новых QSO
- Редактирование существующих QSO
- Удаление QSO

### Статистика
- Общее количество QSO
- Уникальные позывные
- Страны DXCC
- Статистика по диапазонам, режимам и годам

### Профиль
- Информация о пользователе
- Редактирование профиля

### Настройки
- Сохранение URL сервера
- Сохранение учетных данных (опционально)
- Автоматическое подключение при запуске

## Установка

### Требования
- Python 3.9 или выше
- Запущенный сервер TLog REST API (по умолчанию `http://127.0.0.1:8000`)

### Шаги установки

1. Перейдите в директорию клиента:
```bash
cd rest_api_client
```

2. Создайте виртуальное окружение (рекомендуется):
```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Запуск

### Linux/Mac:
```bash
cd rest_api_client
./run.sh
```

### Windows:
```bash
cd rest_api_client
run.bat
```

### Или вручную:
```bash
# Из корневой директории проекта
python -m rest_api_client.main
```

## Использование

### Первое подключение

1. Запустите приложение
2. В меню **Файл** выберите **Подключиться...** (Ctrl+K)
3. Введите URL сервера (по умолчанию `http://127.0.0.1:8000`)
4. Введите имя пользователя и пароль
5. Отметьте **Запомнить учетные данные** для автоматического подключения
6. Нажмите **OK**

Статус подключения отображается в строке состояния внизу окна:
- ● **Подключено** (зелёный) — соединение установлено
- ○ **Не подключено** (красный) — нет соединения

### Быстрый поиск QSO

1. Перейдите на вкладку "Поиск"
2. Выберите тип поиска:
   - **По позывному** — поиск по части позывного корреспондента
   - **По QTH локатору** — поиск по части QTH локатора
   - **По диапазону** — поиск по диапазону (20M, 40M и т.д.)
3. Введите строку для поиска
4. Нажмите **Enter** или кнопку **Найти**
5. Результаты отображаются в компактной таблице

### Компактная таблица результатов

Таблица содержит 8 колонок:
- **Дата** — дата и время QSO (формат ДД.ММ ЧЧ:ММ, без года для компактности)
- **Позывной** — позывной корреспондента
- **Диапазон** — диапазон (20M, 40M, 2M и т.д.)
- **Режим** — режим работы (SSB, CW, FT8 и т.д.)
- **DXCC** — страна
- **QTH** — QTH локатор
- **LoTW** — зелёная галочка ✓ если подтверждено
- **RST** — RST отправлено/получено

Результаты автоматически сортируются по дате (от новых к старым).

### Дополнительные вкладки

- **LoTW** — QSO подтверждённые через LoTW
  - Отображаются только записи с lotw='Y'
  - Сортировка по дате получения подтверждения (app_lotw_rxqsl)
  - **Поиск по позывному** — поиск среди LoTW QSO (фильтрует только подтверждённые)
  - Таблица содержит: Дата QSO, Позывной, Диапазон, Режим, DXCC, QTH, **LoTW дата**, CQ, ITU
  - Формат даты: ДД.ММ.ГГГГ ЧЧ:ММ
  - **Обновить** — перезагрузить список LoTW QSO
  - **Редактировать** — изменить выбранное QSO
  - **Удалить** — удалить выбранное QSO

- **QSO** — полный список всех QSO с подробной информацией
  - **Обновить список** — перезагрузить список всех QSO
  - **Создать QSO** — создать новое QSO
  - **Редактировать** — изменить выбранное QSO
  - **Удалить** — удалить выбранное QSO

- **Статистика** — общая статистика по QSO
- **Профиль** — информация о пользователе

### Меню Файл
- **Подключиться...** (Ctrl+K) — диалог подключения к серверу
- **Отключиться** (Ctrl+D) — отключение от сервера
- **Синхронизировать QSO** (F5) — загрузка новых QSO с сервера
- **Запомнить учетные данные** — сохранение логина/пароля
- **Выход** (Ctrl+Q) — выход из приложения

### Меню Настройки
- **Очистить сохраненные пароли** — удаление сохранённых учетных данных

### Локальная база данных

Все QSO сохраняются в локальную базу данных SQLite (`~/.tlog_rest_client/qsos.db`):

- **Преимущества**:
  - Быстрый поиск без задержек сети
  - Работа оффлайн
  - Минимизация трафика (загружаются только новые QSO)

- **Синхронизация**:
  - Автоматическая при подключении к серверу
  - Ручная через меню Файл → Синхронизировать QSO (F5)
  - Загружаются только новые и обновлённые QSO

- **Поиск**:
  - Все типы поиска работают с локальной базой
  - Мгновенный результат без задержки сети

### Статистика

На вкладке "Статистика" отображается подробная статистика по всем QSO:
- Общее количество
- Уникальные позывные
- Страны DXCC
- Распределение по диапазонам
- Распределение по режимам
- Распределение по годам

## Горячие клавиши

- **Ctrl+K** — Подключиться к серверу
- **Ctrl+D** — Отключиться от сервера
- **F5** — Синхронизировать QSO
- **Ctrl+Q** — Выход из приложения
- **Enter** — Выполнить поиск (в поле ввода)

## Формат даты в приложении

- **Поиск**: дата и время отображаются в формате `ДД.ММ ЧЧ:ММ` (без года для компактности)
- **QSO**: дата и время отображаются в формате `ДД.ММ.ГГГГ ЧЧ:ММ` (полная дата)
- **LoTW**: дата QSO и дата подтверждения отображаются в формате `ДД.ММ.ГГГГ ЧЧ:ММ` (полная дата)

## Хранение настроек и данных

### Настройки
Настройки сохраняются в файле `~/.tlog_rest_client/settings.json`:
- URL сервера
- Учетные данные (если включено "Запомнить")
- Состояние окна
- Последний тип поиска

### Локальная база данных
QSO сохраняются в файле `~/.tlog_rest_client/qsos.db` (SQLite):
- Все загруженные QSO
- Информация о синхронизации
- Индексы для быстрого поиска

Для очистки локальной базы данных удалите файл `qsos.db` и перезапустите приложение.

## Структура файлов

```
rest_api_client/
├── __init__.py         # Пакет приложения
├── main.py             # Точка входа в приложение
├── main_window.py      # Главное окно с GUI
├── qso_dialog.py       # Диалог создания/редактирования QSO
├── tabs.py             # Вкладки приложения (Поиск, LoTW, QSO и т.д.)
├── tables.py           # Настройка и заполнение таблиц QSO
├── workers.py          # Worker потоки для асинхронных операций
├── api_client.py       # REST API клиент
├── settings.py         # Управление настройками
├── database.py         # Локальная база данных SQLite
├── requirements.txt    # Зависимости Python
├── run.sh             # Скрипт запуска для Linux/Mac
├── run.bat            # Скрипт запуска для Windows
└── README.md          # Этот файл

test_api.py            # Тестовый скрипт для API (в корне проекта)
```

## REST API Эндпоинты

Приложение использует следующие эндпоинты:

### QSO
- `GET /api/v1/qsos/` — список всех QSO
- `POST /api/v1/qsos/` — создать QSO
- `GET /api/v1/qsos/{id}/` — получить QSO
- `PUT /api/v1/qsos/{id}/` — обновить QSO
- `PATCH /api/v1/qsos/{id}/` — частично обновить QSO
- `DELETE /api/v1/qsos/{id}/` — удалить QSO
- `GET /api/v1/qsos/stats/` — статистика
- `GET /api/v1/qsos/search/?callsign=XXX` — поиск по позывному
- `GET /api/v1/qsos/by_grid/?grid=XXX` — поиск по QTH локатору
- `GET /api/v1/qsos/by_band/?band=XXX` — поиск по диапазону
- `GET /api/v1/qsos/by_lotw/` — QSO подтверждённые через LoTW (сортировка по дате получения)

### Профиль
- `GET /api/v1/profile/` — получить профиль
- `PATCH /api/v1/profile/` — обновить профиль

### Пользователь
- `GET /api/v1/user-info/` — информация о пользователе

## Требования к серверу

Сервер должен поддерживать:
- Basic Authentication или Session Authentication
- CORS (если клиент запускается с другого домена)
- Все перечисленные выше REST API эндпоинты

## Устранение неполадок

### Ошибка подключения
- Проверьте, что сервер запущен
- Проверьте URL сервера
- Проверьте имя пользователя и пароль

### Ошибка авторизации
- Убедитесь, что учетные данные правильные
- Проверьте, что пользователь имеет доступ к API

### Проблемы с отображением
- Убедитесь, что установлена версия PySide6 не ниже 6.10.0
- Попробуйте изменить размер окна

## Тестирование API без GUI

Для тестирования REST API клиента без запуска GUI можно использовать тестовый скрипт:

```bash
# Из корневой директории проекта
python test_api.py
```

Скрипт запросит учетные данные и проверит все основные функции API:
- Подключение к серверу
- Получение информации о пользователе
- Получение списка QSO
- Статистика
- Профиль пользователя
- Поиск по позывному
- Поиск по QTH локатору

## Лицензия

MIT License

## Поддержка

Для вопросов и предложений обращайтесь к разработчикам TLog.
