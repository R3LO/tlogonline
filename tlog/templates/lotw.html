{% extends 'lotw_base.html' %}
{% load i18n %}
{% load static %}

{% block lotw_content %}
<div class="row">
    <div class="col-lg-9">
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ LoTW -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h5 class="mb-0"><span>üìã</span> {% trans "Recent QSOs with LoTW" %}</h5>
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä—ã –¥–ª—è LoTW QSO - —Ä–∞–∑–º–µ—â–µ–Ω—ã –≤–Ω–µ card-body -->
            <div class="card-body pt-3">
                <div class="filter-card mb-4">
                    <h5 class="section-title"><span>üîç</span> {% trans "–§–∏–ª—å—Ç—Ä—ã" %}</h5>
                    <form class="filter-controls" method="POST" action="{% url 'lotw_page' %}">
                        {% csrf_token %}
                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
                        <input type="hidden" name="page" value="{{ current_page|default:1 }}">
                        
                        <div class="filter-group">
                            <label class="form-label small mb-1">{% trans "–ú–æ–π –ø–æ–∑—ã–≤–Ω–æ–π" %}</label>
                            <select class="form-select form-select-sm" name="my_callsign">
                                <option value="">{% trans "–í—Å–µ" %}</option>
                                {% for my_call in my_callsigns %}
                                    <option value="{{ my_call }}" {% if my_call == my_callsign_filter %}selected{% endif %}>{{ my_call }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="form-label small mb-1">{% trans "–ü–æ–∑—ã–≤–Ω–æ–π" %}</label>
                            <input type="text" class="form-control form-control-sm" name="search_callsign" value="{{ search_callsign }}" placeholder="{% trans '–ü–æ–∑—ã–≤–Ω–æ–π' %}">
                        </div>
                        <div class="filter-group">
                            <label class="form-label small mb-1">QTH –ª–æ–∫–∞—Ç–æ—Ä</label>
                            <input type="text" class="form-control form-control-sm" name="search_qth" value="{{ search_qth }}" placeholder="QTH –ª–æ–∫–∞—Ç–æ—Ä">
                        </div>
                        <div class="filter-group">
                            <label class="form-label small mb-1">{% trans "–î–∏–∞–ø–∞–∑–æ–Ω" %}</label>
                            <select class="form-select form-select-sm" name="band">
                                <option value="">{% trans "–í—Å–µ" %}</option>
                                {% for band in available_bands %}
                                    <option value="{{ band }}" {% if band == band_filter %}selected{% endif %}>{{ band }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="form-label small mb-1">{% trans "–í–∏–¥ —Å–≤—è–∑–∏" %}</label>
                            <select class="form-select form-select-sm" name="mode">
                                <option value="">{% trans "–í—Å–µ" %}</option>
                                {% for mode in available_modes %}
                                    <option value="{{ mode }}" {% if mode == mode_filter %}selected{% endif %}>{{ mode }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="form-label small mb-1">{% trans "–°–ø—É—Ç–Ω–∏–∫" %}</label>
                            <select class="form-select form-select-sm" name="sat_name">
                                <option value="">{% trans "–í—Å–µ" %}</option>
                                {% for sat in available_sat_names %}
                                    <option value="{{ sat }}" {% if sat == sat_name_filter %}selected{% endif %}>{{ sat }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="form-label small mb-1">&nbsp;</label>
                            <button type="submit" name="action" value="reset" class="btn btn-sm reset-btn" id="resetFilters" title="{% trans '–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã' %}">
                                <span>‚ùå</span>
                            </button>
                        </div>
                        
                        <div class="filter-actions">
                            <button type="submit" name="action" value="search" class="btn btn-primary btn-sm" id="searchFilters" title="{% trans '–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã' %}">
                                <span>üîç</span>
                                <span class="ms-1">{% trans "–ù–∞–π—Ç–∏" %}</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card-body pt-0">
                
                <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ö -->
                {% if my_callsign_filter or search_callsign or search_qth or band_filter or mode_filter or sat_name_filter %}
                <div class="filter-notifications mb-4">
                    <div class="alert alert-info border-0 shadow-sm">
                        <div class="d-flex align-items-center">
                            <span class="me-2">üîç</span>
                            <strong>–ü—Ä–∏–º–µ–Ω–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã:</strong>
                        </div>
                        <div class="mt-2 d-flex flex-wrap gap-2">
                            {% if my_callsign_filter %}
                                <span class="badge bg-primary">
                                    <span class="me-1">üë§</span>–ú–æ–π –ø–æ–∑—ã–≤–Ω–æ–π: {{ my_callsign_filter }}
                                </span>
                            {% endif %}
                            {% if search_callsign %}
                                <span class="badge bg-success">
                                    <span class="me-1">üì°</span>–ü–æ–∑—ã–≤–Ω–æ–π: {{ search_callsign }}
                                </span>
                            {% endif %}
                            {% if search_qth %}
                                <span class="badge bg-info">
                                    <span class="me-1">üìç</span>QTH: {{ search_qth }}
                                </span>
                            {% endif %}
                            {% if band_filter %}
                                <span class="badge bg-warning text-dark">
                                    <span class="me-1">üì∂</span>–î–∏–∞–ø–∞–∑–æ–Ω: {{ band_filter }}
                                </span>
                            {% endif %}
                            {% if mode_filter %}
                                <span class="badge bg-secondary">
                                    <span class="me-1">üìü</span>–†–µ–∂–∏–º: {{ mode_filter }}
                                </span>
                            {% endif %}
                            {% if sat_name_filter %}
                                <span class="badge bg-dark">
                                    <span class="me-1">üõ∞Ô∏è</span>–°–ø—É—Ç–Ω–∏–∫: {{ sat_name_filter }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ QSO —Å LoTW –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º -->                
                {% if recent_lotw_qso %}
                <div class="qso-table-container">
                    <div class="lotw-qso-table">
                        <div class="table-responsive">
                            <table class="table table-striped qso-table lotw-table">
                                <thead class="qso-table-header">
                                    <tr>
                                        <th class="col-date"><span>üìÖ</span> {% trans "Date" %}</th>
                                        <th class="col-time"><span>üïê</span> {% trans "Time" %}</th>
                                        <th class="col-my-callsign"><span>üë§</span> {% trans "My Call" %}</th>
                                        <th class="col-callsign"><span>üì°</span> {% trans "Callsign" %}</th>
                                        <th class="col-band"><span>üì∂</span> {% trans "Band" %}</th>
                                        <th class="col-mode"><span>üìü</span> {% trans "Mode" %}</th>
                                        <th class="col-qth"><span>üìç</span> QTH</th>
                                        <th class="col-r150s"><span>üèÜ</span> –†-150-–°</th>
                                        <th class="col-region"><span></span>State</th>
                                        <th class="col-propsat"><span>üì°</span> PROP/SAT</th>
                                        <th class="col-lotw-date"><span>üìß</span> LoTW</th>
                                        <th class="col-lotw"><span>LoTW</span></th>
                                        <th class="col-actions"><span>üëÅÔ∏è</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for qso in recent_lotw_qso %}
                                    <tr>
                                        <td class="col-date" data-label="üìÖ {% trans "Date" %}">
                                            <small>{{ qso.date|date:"d.m.Y" }}</small>
                                        </td>
                                        <td class="col-time" data-label="üïê {% trans "Time" %}">
                                            <small>{{ qso.time|date:"H:i" }}</small>
                                        </td>
                                        <td class="col-my-callsign" data-label="üë§ {% trans "My Call" %}">
                                            <small>{{ qso.my_callsign|default:qso.user.username }}</small>
                                        </td>
                                        <td class="col-callsign" data-label="üì° {% trans "Callsign" %}">
                                            <span class="callsign-badge">{{ qso.callsign }}</span>
                                        </td>
                                        <td class="col-band" data-label="üì∂ {% trans "Band" %}">
                                            {% if qso.band %}
                                                <span class="band-badge">{{ qso.band }}</span>
                                            {% elif qso.frequency %}
                                                {% with band=qso.frequency|default_if_none:"" %}
                                                    <span class="band-badge">{{ band }}</span>
                                                    <br><small class="text-muted">{{ qso.frequency }} MHz</small>
                                                {% endwith %}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="col-mode" data-label="üìü {% trans "Mode" %}">
                                            <span class="mode-badge">{{ qso.mode }}</span>
                                        </td>
                                        <td class="col-qth" data-label="üìç QTH">
                                            {% if qso.gridsquare %}
                                                <small>{{ qso.gridsquare }}</small>
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-r150s" data-label="üèÜ –†-150-–°">
                                            {% if qso.r150s %}
                                                {{ qso.r150s }}
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-region" data-label="üá∑üá∫ RU">
                                            {% if qso.state %}
                                                <span class="region-badge" title="{{ qso.state }}">{{ qso.state }}</span>
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-propsat" data-label="üì° PROP/SAT">
                                            {% if qso.prop_mode or qso.sat_name %}
                                                <small>
                                                    {% if qso.prop_mode %}{{ qso.prop_mode }}{% endif %}
                                                    {% if qso.prop_mode and qso.sat_name %} / {% endif %}
                                                    {% if qso.sat_name %}{{ qso.sat_name }}{% endif %}
                                                </small>
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-lotw-date" data-label="üìß LoTW">
                                            <span class="lotw-date-badge">{{ qso.app_lotw_rxqsl|date:"d.m.Y" }}</span>
                                        </td>
                                        <td class="col-lotw" data-label="LoTW">
                                            <span class="lotw-confirmed" title="{% trans 'LoTW Confirmed' %}">‚úÖ</span>
                                        </td>
                                        <td class="col-actions" data-label="üëÅÔ∏è">
                                            <button type="button" class="btn btn-sm btn-outline-info view-qso-btn" 
                                                    data-qso-id="{{ qso.id }}" title="{% trans '–ü—Ä–æ—Å–º–æ—Ç—Ä QSO' %}">
                                                <span>üëÅÔ∏è</span>
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è QSO —Å LoTW -->
                <div class="pagination-info text-center text-muted mb-2">
                    <small>
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ current_page }} –∏–∑ {{ total_pages }} 
                        (<span data-current-count>{{ recent_lotw_qso|length }}</span> –∏–∑ <span data-total-count>{{ lotw_confirmed_count }}</span> –∑–∞–ø–∏—Å–µ–π)
                    </small>
                </div>

                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ–¥ —Ç–∞–±–ª–∏—Ü–µ–π -->
                <form method="POST" action="{% url 'lotw_page' %}" class="d-inline">
                    {% csrf_token %}
                    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
                    <input type="hidden" name="my_callsign" value="{{ my_callsign_filter }}">
                    <input type="hidden" name="search_callsign" value="{{ search_callsign }}">
                    <input type="hidden" name="search_qth" value="{{ search_qth }}">
                    <input type="hidden" name="band" value="{{ band_filter }}">
                    <input type="hidden" name="mode" value="{{ mode_filter }}">
                    <input type="hidden" name="sat_name" value="{{ sat_name_filter }}">
                
                    <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º QSO" class="mt-4">
                        <ul class="pagination justify-content-center">
                            {% if current_page > 1 %}
                                <li class="page-item">
                                    <button type="submit" name="page" value="{{ current_page|add:'-1' }}" class="page-link btn-link bg-transparent border-0 text-decoration-none">
                                        –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                                    </button>
                                </li>
                            {% endif %}

                            {% load custom_filters %}
                            {% paginate_numbers current_page total_pages 3 as page_numbers %}
                            {% for page_num in page_numbers %}
                                {% if page_num == '...' %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                {% elif page_num == current_page %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ page_num }}</span>
                                    </li>
                                {% else %}
                                    <li class="page-item">
                                        <button type="submit" name="page" value="{{ page_num }}" class="page-link btn-link bg-transparent border-0 text-decoration-none">
                                            {{ page_num }}
                                        </button>
                                    </li>
                                {% endif %}
                            {% endfor %}

                            {% if current_page < total_pages %}
                                <li class="page-item">
                                    <button type="submit" name="page" value="{{ current_page|add:'1' }}" class="page-link btn-link bg-transparent border-0 text-decoration-none">
                                        –°–ª–µ–¥—É—é—â–∞—è
                                    </button>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </form>
                
                <div class="text-center mt-3">
                    {% if lotw_confirmed_count > 20 %}
                    <div class="text-muted mb-2">
                        <small>
                            –ü–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä–≤—ã–µ {{ recent_lotw_qso|length }} –∏–∑ {{ lotw_confirmed_count }} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö QSO
                        </small>
                    </div>
                    {% endif %}
                    <a href="/logbook/" class="btn btn-outline-primary btn-sm">
                        <span>üìã</span> {% trans "–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ–≥–æ –ª–æ–≥–∞" %}
                    </a>
                </div>
                
                {% else %}
                <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ QSO -->
                <div class="qso-table-empty text-center">
                    <div class="qso-table-empty-title mb-3">
                        <span class="display-4 d-block mb-3">üìã</span>
                        <h4 class="text-primary fw-bold">LoTW QSL –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</h4>
                    </div>
                    <div class="qso-table-empty-text">
                        <p class="lead text-muted mb-0">
                            –ù–∞—Å—Ç—Ä–æ–π—Ç–µ LoTW —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å LoTW –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ.
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-lg-3">
        <!-- –°—Ç–∞—Ç—É—Å LoTW -->
        <div class="card mb-4 fade-in lotw-statistics">
            <div class="card-header">
                <h6 class="mb-0"><span>üìä</span> {% trans "–°—Ç–∞—Ç—É—Å LoTW" %}</h6>
            </div>
            <div class="card-body">
                {% if profile.lotw_user and profile.lotw_password %}
                    {% if profile.lotw_chk_pass %}
                        <div class="alert alert-success py-2">
                            <span class="me-2">‚úÖ</span>
                            <strong>{% trans "LoTW Connected" %}</strong>
                        </div>
                        <p class="mb-2">
                            <span class="me-2">üë§</span>
                            <small>{% trans "Username:" %} <strong>{{ profile.lotw_user }}</strong></small>
                        </p>
                        {% if profile.lotw_lastsync %}
                            <p class="mb-0">
                                <span class="me-2">üìÖ</span>
                                <small>{% trans "Last sync:" %} <strong>{{ profile.lotw_lastsync|date:"d.m.Y" }}</strong></small>
                            </p>
                        {% else %}
                            <p class="mb-0 text-muted">
                                <span class="me-2">‚ùå</span>
                                <small>{% trans "No sync performed yet" %}</small>
                            </p>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-danger py-2">
                            <span class="me-2">‚ùå</span>
                            <strong>{% trans "Disconnected" %}</strong>
                        </div>
                        <p class="mb-2">
                            <span class="me-2">üë§</span>
                            <small>{% trans "Username:" %} <strong>{{ profile.lotw_user }}</strong></small>
                        </p>
                        <p class="mb-0 text-muted">
                            <small>{% trans "Please check your LoTW login credentials" %}</small>
                        </p>
                    {% endif %}
                {% else %}
                    <div class="alert alert-info py-2">
                        <span class="me-2">‚ÑπÔ∏è</span>
                        <strong>{% trans "LoTW Not Configured" %}</strong>
                    </div>
                    <p class="mb-0 text-muted">
                        <small>{% trans "Add your LoTW credentials in profile settings" %}</small>
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="card mb-4 fade-in lotw-statistics">
            <div class="card-header">
                <h6 class="mb-0"><span>üìà</span> {% trans "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" %}</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö -->
                    <div class="col-12">
                        <div class="text-center mb-2">
                            <small class="text-muted">
                                <span class="me-1">üîç</span>–° —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
                            </small>
                        </div>
                    </div>

                    <!-- –í—Å–µ–≥–æ QSO CFM -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üìä</span>
                                <span class="fw-medium">–í—Å–µ–≥–æ QSO CFM</span>
                            </div>
                            <div class="stat-number text-dark fw-bold h5 mb-0">{{ total_qso_count|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑—ã–≤–Ω—ã—Ö -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üìª</span>
                                <span class="fw-medium">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑—ã–≤–Ω—ã—Ö</span>
                            </div>
                            <div class="stat-number text-success fw-bold h5 mb-0">{{ unique_callsigns_count|default:0 }}</div>
                        </div>
                    </div>

                    <!-- DXCC —Å—Ç—Ä–∞–Ω -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üåç</span>
                                <span class="fw-medium">–°—Ç—Ä–∞–Ω DXCC</span>
                            </div>
                            <div class="stat-number text-primary fw-bold h5 mb-0">{{ dxcc_entities|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –†-150-–° —Å—Ç—Ä–∞–Ω -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üèÜ</span>
                                <span class="fw-medium">–°—Ç—Ä–∞–Ω –†-150-–°</span>
                            </div>
                            <div class="stat-number text-success fw-bold h5 mb-0">{{ r150s_entities|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –†–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏ -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üá∑üá∫</span>
                                <span class="fw-medium">–†–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏</span>
                            </div>
                            <div class="stat-number text-warning fw-bold h5 mb-0">{{ ru_states|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –®—Ç–∞—Ç–æ–≤ USA -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üá∫üá∏</span>
                                <span class="fw-medium">–®—Ç–∞—Ç–æ–≤ USA</span>
                            </div>
                            <div class="stat-number text-info fw-bold h5 mb-0">{{ usa_states|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–≤–∏–Ω—Ü–∏–π –ö–∏—Ç–∞—è -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üá®üá≥</span>
                                <span class="fw-medium">–ü—Ä–æ–≤–∏–Ω—Ü–∏–π –ö–∏—Ç–∞—è</span>
                            </div>
                            <div class="stat-number text-danger fw-bold h5 mb-0">{{ china_states|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –ü—Ä–µ—Ñ–µ–∫—Ç—É—Ä –Ø–ø–æ–Ω–∏–∏ -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üáØüáµ</span>
                                <span class="fw-medium">–ü—Ä–µ—Ñ–µ–∫—Ç—É—Ä –Ø–ø–æ–Ω–∏–∏</span>
                            </div>
                            <div class="stat-number text-secondary fw-bold h5 mb-0">{{ japan_states|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –†–∞–π–æ–Ω–æ–≤ –ê–≤—Å—Ç—Ä–∞–ª–∏–∏ -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üá¶üá∫</span>
                                <span class="fw-medium">–†–∞–π–æ–Ω–æ–≤ –ê–≤—Å—Ç—Ä–∞–ª–∏–∏</span>
                            </div>
                            <div class="stat-number text-success fw-bold h5 mb-0">{{ australia_states|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–≤–∏–Ω—Ü–∏–π –ö–∞–Ω–∞–¥—ã -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üá®üá¶</span>
                                <span class="fw-medium">–ü—Ä–æ–≤–∏–Ω—Ü–∏–π –ö–∞–Ω–∞–¥—ã</span>
                            </div>
                            <div class="stat-number text-warning fw-bold h5 mb-0">{{ canada_states|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –ó–æ–Ω CQ -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üåç</span>
                                <span class="fw-medium">–ó–æ–Ω CQ</span>
                            </div>
                            <div class="stat-number text-primary fw-bold h5 mb-0">{{ cq_zones|default:0 }}</div>
                        </div>
                    </div>

                    <!-- –ó–æ–Ω ITU -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üì°</span>
                                <span class="fw-medium">–ó–æ–Ω ITU</span>
                            </div>
                            <div class="stat-number text-info fw-bold h5 mb-0">{{ itu_zones|default:0 }}</div>
                        </div>
                    </div>

                    <!-- QTH –ª–æ–∫–∞—Ç–æ—Ä–æ–≤ -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üìç</span>
                                <span class="fw-medium">QTH –ª–æ–∫–∞—Ç–æ—Ä–æ–≤</span>
                            </div>
                            <div class="stat-number text-success fw-bold h5 mb-0">{{ qth_locators|default:0 }}</div>
                        </div>
                    </div>

                    <!-- IOTA -->
                    <div class="col-12">
                        <div class="stat-item p-3 border rounded bg-light d-flex align-items-center justify-content-between">
                            <div class="stat-label small text-muted">
                                <span class="me-2">üèùÔ∏è</span>
                                <span class="fw-medium">IOTA</span>
                            </div>
                            <div class="stat-number text-warning fw-bold h5 mb-0">{{ iota_count|default:0 }}</div>
                        </div>
                    </div>
                </div>

                <hr class="my-3">
                
                <!-- –ë–ª–æ–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è LoTW ADIF -->
                <div class="card border-success">
                    <div class="card-header bg-success text-white py-2">
                        <h6 class="mb-0">
                            <span class="me-2">üì¶</span>–°–∫–∞—á–∞—Ç—å LoTW ADIF
                        </h6>
                    </div>
                    <div class="card-body p-3">
                        <p class="mb-3 small text-muted">
                            <span class="me-2">‚ÑπÔ∏è</span>–§–∞–π–ª ADIF —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
                        </p>

                        <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
                        <form action="{% url 'export_lotw_adif' %}" method="get" class="text-center">
                            <input type="hidden" name="my_callsign" value="{{ my_callsign_filter }}">
                            <input type="hidden" name="search_callsign" value="{{ search_callsign }}">
                            <input type="hidden" name="search_qth" value="{{ search_qth }}">
                            <input type="hidden" name="band" value="{{ band_filter }}">
                            <input type="hidden" name="mode" value="{{ mode_filter }}">
                            <input type="hidden" name="sat_name" value="{{ sat_name_filter }}">
                            <button type="submit" class="btn btn-success btn-lg" title="–≠–∫—Å–ø–æ—Ä—Ç LoTW –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö QSO –≤ ADIF —Ñ–∞–π–ª">
                                <span class="me-2">üì•</span>–°–∫–∞—á–∞—Ç—å ADIF —Ñ–∞–π–ª
                            </button>
                        </form>
                        
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π -->
                        {% if lotw_confirmed_count > 0 %}
                        <div class="mt-3 text-center">
                            <small class="text-muted">
                                <span class="me-1">üìä</span>–ë—É–¥–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ {{ lotw_confirmed_count }} LoTW –∑–∞–ø–∏—Å–µ–π
                            </small>
                        </div>
                        {% else %}
                        <div class="mt-3 text-center">
                            <small class="text-muted">
                                <span class="me-1">‚ö†Ô∏è</span>–ù–µ—Ç LoTW –∑–∞–ø–∏—Å–µ–π –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                            </small>
                        </div>
                        {% endif %}
                    </div>
                </div>               
                
            </div>
        </div>
</div>

<!-- –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO -->
<div class="modal fade" id="viewQSOModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    üìã –î–µ—Ç–∞–ª–∏ QSO
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-3">
                <div class="row g-3">
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="col-md-6">
                        <div class="card border-primary h-100">
                            <div class="card-header bg-primary text-white py-2">
                                <h6 class="mb-0">üìä –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                            </div>
                            <div class="card-body p-3">
                                <div class="row g-2 small">
                                    <div class="col-5 text-muted">üÜî ID QSO:</div>
                                    <div class="col-7"><span id="view_id" class="badge bg-dark text-light">-</span></div>

                                    <div class="col-5 text-muted">üìÖ –î–∞—Ç–∞:</div>
                                    <div class="col-7"><span id="view_date">-</span></div>
                                    
                                    <div class="col-5 text-muted">üïê –í—Ä–µ–º—è:</div>
                                    <div class="col-7"><span id="view_time">-</span></div>
                                    
                                    <div class="col-5 text-muted">üë§ –ú–æ–π –ø–æ–∑—ã–≤–Ω–æ–π:</div>
                                    <div class="col-7"><span id="view_my_callsign" class="badge bg-primary">-</span></div>
                                    
                                    <div class="col-5 text-muted">üì° –ü–æ–∑—ã–≤–Ω–æ–π:</div>
                                    <div class="col-7"><span id="view_callsign" class="badge bg-success">-</span></div>
                                    
                                    <div class="col-5 text-muted">üì∂ –î–∏–∞–ø–∞–∑–æ–Ω:</div>
                                    <div class="col-7"><span id="view_band" class="badge bg-secondary">-</span></div>
                                    
                                    <div class="col-5 text-muted">üìü –†–µ–∂–∏–º:</div>
                                    <div class="col-7"><span id="view_mode" class="badge bg-info">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="col-md-6">
                        <div class="card border-info h-100">
                            <div class="card-header bg-info text-white py-2">
                                <h6 class="mb-0">üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                            </div>
                            <div class="card-body p-3">
                                <div class="row g-2 small">
                                    <div class="col-5 text-muted">üìà –ß–∞—Å—Ç–æ—Ç–∞:</div>
                                    <div class="col-7"><span id="view_frequency" class="text-mono">-</span></div>
                                    
                                    <div class="col-5 text-muted">üì§ RST –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π:</div>
                                    <div class="col-7"><span id="view_rst_sent" class="badge bg-warning">-</span></div>
                                    
                                    <div class="col-5 text-muted">üì• RST –ø—Ä–∏–Ω—è—Ç—ã–π:</div>
                                    <div class="col-7"><span id="view_rst_rcvd" class="badge bg-warning">-</span></div>
                                    
                                    <div class="col-5 text-muted">üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫:</div>
                                    <div class="col-7"><span id="view_sat_name">-</span></div>
                                    
                                    <div class="col-5 text-muted">üì° Prop Mode:</div>
                                    <div class="col-7"><span id="view_prop_mode">-</span></div>
                                    
                                    <div class="col-5 text-muted">üåç DXCC:</div>
                                    <div class="col-7"><span id="view_dxcc" class="badge bg-primary">-</span></div>
                                    
                                    <div class="col-5 text-muted">üèùÔ∏è IOTA:</div>
                                    <div class="col-7"><span id="view_iota">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-3 mt-2">
                    <!-- –õ–æ–∫–∞—Ü–∏—è -->
                    <div class="col-md-6">
                        <div class="card border-success h-100">
                            <div class="card-header bg-success text-white py-2">
                                <h6 class="mb-0">üìç –õ–æ–∫–∞—Ü–∏—è</h6>
                            </div>
                            <div class="card-body p-3">
                                <div class="row g-2 small">
                                    <div class="col-5 text-muted">üéØ –ú–æ–π –ª–æ–∫–∞—Ç–æ—Ä:</div>
                                    <div class="col-7"><span id="view_my_gridsquare" class="badge bg-success">-</span></div>
                                    
                                    <div class="col-5 text-muted">üéØ –õ–æ–∫–∞—Ç–æ—Ä:</div>
                                    <div class="col-7"><span id="view_gridsquare" class="badge bg-success">-</span></div>
                                    
                                    <div class="col-5 text-muted">üåé –ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç:</div>
                                    <div class="col-7"><span id="view_continent">-</span></div>
                                    
                                    <div class="col-5 text-muted">üá∑üá∫ –†–µ–≥–∏–æ–Ω –†–§:</div>
                                    <div class="col-7"><span id="view_state" class="badge bg-warning">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- QSL —Å—Ç–∞—Ç—É—Å -->
                    <div class="col-md-6">
                        <div class="card border-warning h-100">
                            <div class="card-header bg-warning text-dark py-2">
                                <h6 class="mb-0">üèÜ QSL —Å—Ç–∞—Ç—É—Å</h6>
                            </div>
                            <div class="card-body p-3">
                                <div class="row g-2 small">
                                    <div class="col-5 text-muted">üìß LoTW:</div>
                                    <div class="col-7"><span id="view_lotw" class="badge bg-info">-</span></div>
                                    
                                    <div class="col-5 text-muted">üìÆ Paper QSL:</div>
                                    <div class="col-7"><span id="view_paper_qsl" class="badge bg-warning">-</span></div>
                                    
                                    <div class="col-5 text-muted">üèÜ R150s:</div>
                                    <div class="col-7"><span id="view_r150s" class="badge bg-success">-</span></div>
                                    
                                    <div class="col-5 text-muted">üìÖ LoTW RXQSL:</div>
                                    <div class="col-7"><span id="view_app_lotw_rxqsl">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    ‚ùå –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>


</div>

{% endblock %}
