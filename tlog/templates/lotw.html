{% extends 'lotw_base.html' %}
{% load i18n %}
{% load static %}

{% block lotw_content %}
<div class="row">
    <div class="col-lg-9">
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ LoTW -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h5 class="mb-0"><span>üìã</span> {% trans "What is LoTW?" %}</h5>
            </div>
            <div class="card-body">
                <p class="card-text">
                    {% trans "LoTW (Logbook of the World) is a system maintained by the American Radio Relay League (ARRL) that allows amateur radio operators to submit and confirm their QSO records electronically." %}
                </p>
                <p class="card-text">
                    {% trans "Through LoTW, radio amateurs can confirm QSOs with other operators worldwide, earning credits for various awards such as DXCC, WAS, and others." %}
                </p>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ QSO -->
                <div class="lotw-qso-stats">
                    <div class="lotw-qso-stat-card">
                        <div class="lotw-qso-stat-icon">üì°</div>
                        <div class="lotw-qso-stat-value">{{ total_qso_count|default:"0" }}</div>
                        <div class="lotw-qso-stat-label">{% trans "Total QSOs" %}</div>
                    </div>
                    <div class="lotw-qso-stat-card">
                        <div class="lotw-qso-stat-icon">‚úÖ</div>
                        <div class="lotw-qso-stat-value">{{ lotw_confirmed_count|default:"0" }}</div>
                        <div class="lotw-qso-stat-label">{% trans "LoTW Confirmed" %}</div>
                    </div>
                    <div class="lotw-qso-stat-card">
                        <div class="lotw-qso-stat-icon">üåç</div>
                        <div class="lotw-qso-stat-value">{{ dxcc_entities|default:"0" }}</div>
                        <div class="lotw-qso-stat-label">{% trans "DXCC Entities" %}</div>
                    </div>
                    <div class="lotw-qso-stat-card">
                        <div class="lotw-qso-stat-icon">üèÜ</div>
                        <div class="lotw-qso-stat-value">{{ award_credits|default:"0" }}</div>
                        <div class="lotw-qso-stat-label">{% trans "Award Credits" %}</div>
                    </div>
                </div>
                
                <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ QSO —Å LoTW –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º -->
                <h6 class="lotw-qso-section-title">
                    <span>üìä</span> {% trans "Recent QSOs with LoTW" %}
                </h6>
                
                {% if recent_lotw_qso %}
                <div class="qso-table-container">
                    <div class="lotw-qso-table">
                        <div class="table-responsive">
                            <table class="table table-striped qso-table lotw-table">
                                <thead class="qso-table-header">
                                    <tr>
                                        <th class="col-date"><span>üìÖ</span> {% trans "Date" %}</th>
                                        <th class="col-time"><span>üïê</span> {% trans "Time" %}</th>
                                        <th class="col-my-callsign"><span>üë§</span> {% trans "My Call" %}</th>
                                        <th class="col-callsign"><span>üì°</span> {% trans "Callsign" %}</th>
                                        <th class="col-band"><span>üì∂</span> {% trans "Band" %}</th>
                                        <th class="col-mode"><span>üìü</span> {% trans "Mode" %}</th>
                                        <th class="col-qth"><span>üìç</span> QTH</th>
                                        <th class="col-r150s"><span>üèÜ</span> –†-150-–°</th>
                                        <th class="col-region"><span>üåç</span> {% trans "Region" %}</th>
                                        <th class="col-propsat"><span>üì°</span> PROP/SAT</th>
                                        <th class="col-lotw-date"><span>üìß</span> LoTW</th>
                                        <th class="col-lotw"><span>LoTW</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for qso in recent_lotw_qso %}
                                    <tr>
                                        <td class="col-date" data-label="üìÖ {% trans "Date" %}">
                                            <small>{{ qso.date|date:"d.m.Y" }}</small>
                                        </td>
                                        <td class="col-time" data-label="üïê {% trans "Time" %}">
                                            <small>{{ qso.time|date:"H:i" }}</small>
                                        </td>
                                        <td class="col-my-callsign" data-label="üë§ {% trans "My Call" %}">
                                            <small>{{ qso.my_callsign|default:qso.user.username }}</small>
                                        </td>
                                        <td class="col-callsign" data-label="üì° {% trans "Callsign" %}">
                                            <span class="callsign-badge">{{ qso.callsign }}</span>
                                        </td>
                                        <td class="col-band" data-label="üì∂ {% trans "Band" %}">
                                            {% if qso.band %}
                                                <span class="band-badge">{{ qso.band }}</span>
                                            {% elif qso.frequency %}
                                                {% with band=qso.frequency|default_if_none:"" %}
                                                    <span class="band-badge">{{ band }}</span>
                                                    <br><small class="text-muted">{{ qso.frequency }} MHz</small>
                                                {% endwith %}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="col-mode" data-label="üìü {% trans "Mode" %}">
                                            <span class="mode-badge">{{ qso.mode }}</span>
                                        </td>
                                        <td class="col-qth" data-label="üìç QTH">
                                            {% if qso.gridsquare %}
                                                <small>{{ qso.gridsquare }}</small>
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-r150s" data-label="üèÜ –†-150-–°">
                                            {% if qso.r150s %}
                                                {{ qso.r150s }}
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-region" data-label="üåç {% trans "Region" %}">
                                            {% if qso.ru_region %}
                                                <span class="region-badge" title="{{ qso.ru_region }}">{{ qso.ru_region }}</span>
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-propsat" data-label="üì° PROP/SAT">
                                            {% if qso.prop_mode or qso.sat_name %}
                                                <small>
                                                    {% if qso.prop_mode %}{{ qso.prop_mode }}{% endif %}
                                                    {% if qso.prop_mode and qso.sat_name %} / {% endif %}
                                                    {% if qso.sat_name %}{{ qso.sat_name }}{% endif %}
                                                </small>
                                            {% else %}
                                                <small class="text-muted">-</small>
                                            {% endif %}
                                        </td>
                                        <td class="col-lotw-date" data-label="üìß LoTW">
                                            <span class="lotw-date-badge">{{ qso.app_lotw_rxqsl|date:"d.m.Y" }}</span>
                                        </td>
                                        <td class="col-lotw" data-label="LoTW">
                                            <span class="lotw-confirmed" title="{% trans 'LoTW Confirmed' %}">‚úÖ</span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è QSO —Å LoTW -->
                {% if total_pages > 1 %}
                <div class="pagination-info text-center text-muted mb-2">
                    <small>
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ current_page }} –∏–∑ {{ total_pages }} 
                        ({{ recent_lotw_qso|length }} –∏–∑ {{ lotw_confirmed_count }} –∑–∞–ø–∏—Å–µ–π)
                    </small>
                </div>
                <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º QSO" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if current_page > 1 %}
                            <li class="page-item">
                                <a class="page-link" href="{% url 'lotw_page' %}?page={{ current_page|add:'-1' }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                            </li>
                        {% endif %}

                        {% load custom_filters %}
                        {% paginate_numbers current_page total_pages 3 as page_numbers %}
                        {% for page_num in page_numbers %}
                            {% if page_num == '...' %}
                                <li class="page-item disabled">
                                    <span class="page-link">...</span>
                                </li>
                            {% elif page_num == current_page %}
                                <li class="page-item active">
                                    <span class="page-link">{{ page_num }}</span>
                                </li>
                            {% else %}
                                <li class="page-item">
                                    <a class="page-link" href="{% url 'lotw_page' %}?page={{ page_num }}">{{ page_num }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}

                        {% if current_page < total_pages %}
                            <li class="page-item">
                                <a class="page-link" href="{% url 'lotw_page' %}?page={{ current_page|add:'1' }}">–°–ª–µ–¥—É—é—â–∞—è</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
                
                <div class="text-center mt-3">
                    {% if lotw_confirmed_count > 20 %}
                    <div class="text-muted mb-2">
                        <small>
                            –ü–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä–≤—ã–µ {{ recent_lotw_qso|length }} –∏–∑ {{ lotw_confirmed_count }} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö QSO
                        </small>
                    </div>
                    {% endif %}
                    <a href="/logbook/?lotw=Y" class="btn btn-outline-primary btn-sm">
                        <span>üìã</span> {% trans "View All LoTW QSOs" %}
                    </a>
                </div>
                
                {% else %}
                <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ QSO -->
                <div class="qso-table-empty">
                    <div class="qso-table-empty-icon">üì°</div>
                    <div class="qso-table-empty-title">{% trans "No LoTW QSOs Yet" %}</div>
                    <div class="qso-table-empty-text">
                        {% trans "Start logging your QSOs to see them here with LoTW confirmation status." %}
                    </div>
                    <a href="/logbook/" class="btn btn-primary">
                        <span>üìù</span> {% trans "Add Your First QSO" %}
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ LoTW -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h5 class="mb-0"><span>‚ú®</span> {% trans "Benefits of LoTW" %}</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2"><span class="text-primary">üìä</span> {% trans "Electronic QSO confirmation" %}</li>
                            <li class="mb-2"><span class="text-primary">üèÜ</span> {% trans "Award credit accumulation" %}</li>
                            <li class="mb-2"><span class="text-primary">üí∞</span> {% trans "Free to use" %}</li>
                            <li class="mb-2"><span class="text-primary">üåç</span> {% trans "Global QSO database" %}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2"><span class="text-primary">‚ö°</span> {% trans "Instant QSO confirmation" %}</li>
                            <li class="mb-2"><span class="text-primary">üì±</span> {% trans "Mobile app support" %}</li>
                            <li class="mb-2"><span class="text-primary">üîí</span> {% trans "Secure and reliable" %}</li>
                            <li class="mb-2"><span class="text-primary">üìà</span> {% trans "Detailed statistics" %}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–∞–∫ –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LoTW -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h5 class="mb-0"><span>üöÄ</span> {% trans "Getting Started with LoTW" %}</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>{% trans "Step 1: Registration" %}</h6>
                        <p class="small">{% trans "Create a free account on the LoTW website" %}</p>
                        
                        <h6>{% trans "Step 2: Certificate Request" %}</h6>
                        <p class="small">{% trans "Request a digital certificate for your callsign" %}</p>
                        
                        <h6>{% trans "Step 3: Certificate Installation" %}</h6>
                        <p class="small">{% trans "Install the certificate in your logging software" %}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>{% trans "Step 4: QSO Logging" %}</h6>
                        <p class="small">{% trans "Log your QSOs using software that supports LoTW" %}</p>
                        
                        <h6>{% trans "Step 5: Upload Logs" %}</h6>
                        <p class="small">{% trans "Upload your ADIF files to LoTW for confirmation" %}</p>
                        
                        <h6>{% trans "Step 6: Award Applications" %}</h6>
                        <p class="small">{% trans "Apply for awards once you have enough confirmations" %}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h5 class="mb-0"><span>üîó</span> {% trans "Useful Links" %}</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <a href="https://lotw.arrl.org/lotwuser/default" target="_blank" class="btn btn-outline-primary mb-2 w-100">
                            <span>üåê</span> {% trans "LoTW Official Website" %}
                        </a>
                        <a href="https://lotw.arrl.org/lotwuser/lotwhelp/default" target="_blank" class="btn btn-outline-info mb-2 w-100">
                            <span>üìö</span> {% trans "LoTW Help & Documentation" %}
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="https://www.arrl.org/dxcc" target="_blank" class="btn btn-outline-success mb-2 w-100">
                            <span>üèÜ</span> {% trans "DXCC Award Information" %}
                        </a>
                        <a href="https://www.arrl.org/was" target="_blank" class="btn btn-outline-warning mb-2 w-100">
                            <span>üéñÔ∏è</span> {% trans "WAS Award Information" %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-lg-3">
        <!-- –°—Ç–∞—Ç—É—Å LoTW -->
        <div class="card mb-4 fade-in lotw-status">
            <div class="card-header">
                <h6 class="mb-0"><span>üìä</span> {% trans "Your LoTW Status" %}</h6>
            </div>
            <div class="card-body">
                {% if profile.lotw_user and profile.lotw_password %}
                    {% if profile.lotw_chk_pass %}
                        <div class="alert alert-success py-2">
                            <span class="me-2">‚úÖ</span>
                            <strong>{% trans "LoTW Connected" %}</strong>
                        </div>
                        <p class="mb-2">
                            <span class="me-2">üë§</span>
                            <small>{% trans "Username:" %} <strong>{{ profile.lotw_user }}</strong></small>
                        </p>
                        {% if profile.lotw_lastsync %}
                            <p class="mb-0">
                                <span class="me-2">üìÖ</span>
                                <small>{% trans "Last sync:" %} <strong>{{ profile.lotw_lastsync|date:"d.m.Y H:i" }}</strong></small>
                            </p>
                        {% else %}
                            <p class="mb-0 text-muted">
                                <span class="me-2">‚ùå</span>
                                <small>{% trans "No sync performed yet" %}</small>
                            </p>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-warning py-2">
                            <span class="me-2">‚ö†Ô∏è</span>
                            <strong>{% trans "LoTW Authentication Failed" %}</strong>
                        </div>
                        <p class="mb-0 text-muted">
                            <small>{% trans "Please check your LoTW login credentials" %}</small>
                        </p>
                    {% endif %}
                {% else %}
                    <div class="alert alert-info py-2">
                        <span class="me-2">‚ÑπÔ∏è</span>
                        <strong>{% trans "LoTW Not Configured" %}</strong>
                    </div>
                    <p class="mb-0 text-muted">
                        <small>{% trans "Add your LoTW credentials in profile settings" %}</small>
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="card mb-4 fade-in quick-actions">
            <div class="card-header">
                <h6 class="mb-0"><span>‚ö°</span> {% trans "Quick Actions" %}</h6>
            </div>
            <div class="card-body">
                <a href="/dashboard/profile/" class="btn btn-primary w-100 mb-2">
                    <span>‚öôÔ∏è</span> {% trans "Configure LoTW" %}
                </a>
                <a href="/dashboard/" class="btn btn-outline-primary w-100 mb-2">
                    <span>üìä</span> {% trans "View Dashboard" %}
                </a>
                <a href="/logbook/" class="btn btn-outline-secondary w-100">
                    <span>üìã</span> {% trans "Manage Logbook" %}
                </a>
            </div>
        </div>

        <!-- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
        <div class="card mb-4 fade-in">
            <div class="card-header">
                <h6 class="mb-0"><span>üíª</span> {% trans "Supported Software" %}</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2"><span class="text-primary">üì±</span> <small>{% trans "TQSL (ARRL's official LoTW software)" %}</small></li>
                    <li class="mb-2"><span class="text-primary">üì±</span> <small>{% trans "DXToolbox" %}</small></li>
                    <li class="mb-2"><span class="text-primary">üì±</span> <small>{% trans "QSO Log" %}</small></li>
                    <li class="mb-2"><span class="text-primary">üì±</span> <small>{% trans "LoTW Mobile" %}</small></li>
                    <li class="mb-0"><span class="text-primary">üì±</span> <small>{% trans "And many more..." %}</small></li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
