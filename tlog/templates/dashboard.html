{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% block title %}TLog - {% trans "Profile" %}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="main-container">
        <!-- Header -->
        <div class="logbook-header text-center">
            <h2><span>üìä</span> {% trans "Profile" %}</h2>
            <p class="mb-0">{% trans "Manage your QSO and statistics" %}</p>
        </div>

        <div class="p-4">
            <div class="row">
                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
                <div class="col-lg-9">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ QO-100 -->
            <div class="stats-section mb-4">
                <h5 class="section-title">üì° QO-100 {% trans "Statistics" %}</h5>
                <div class="row g-3">
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üì°</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">QSO Uniq</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üåç</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">QSO DXCC</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üè≥Ô∏è</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">–†-150-–°</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üá∑üá∫</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">RU Reg</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üìç</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">CQ Zone</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üåê</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">ITU Zone</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üéØ</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Grid</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üìã</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">{% trans "Total QSOs" %}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ö–í+–£–ö–í -->
            <div class="stats-section mb-4">
                <h5 class="section-title">üìä HF+VHF {% trans "Statistics" %}</h5>
                <div class="row g-3">
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üì°</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">QSO Uniq</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üåç</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">QSO DXCC</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üè≥Ô∏è</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">–†-150-–°</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üá∑üá∫</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">RU Reg</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üìç</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">CQ Zone</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üåê</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">ITU Zone</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üéØ</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Grid</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="stat-icon mb-2">üìã</div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">{% trans "Total QSOs" %}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="filter-card mb-4">
                <h5 class="section-title"><span>üîç</span> {% trans "Filters" %}</h5>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label class="form-label small mb-1">{% trans "My Callsign" %}</label>
                        <select class="form-select">
                            <option value="">{% trans "All" %}</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label small mb-1">{% trans "Band" %}</label>
                        <select class="form-select">
                            <option value="">{% trans "All" %}</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label small mb-1">{% trans "Mode" %}</label>
                        <select class="form-select">
                            <option value="">{% trans "All" %}</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label small mb-1">Prop Mode</label>
                        <select class="form-select">
                            <option value="">{% trans "All" %}</option>
                            <option value="SAT">SAT</option>
                            <option value="AUR">AUR</option>
                            <option value="ES">ES</option>
                            <option value="F2">F2</option>
                            <option value="TRO">TRO</option>
                            <option value="MS">MS</option>
                            <option value="ECH">ECH</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label small mb-1">{% trans "Satellite" %}</label>
                        <select class="form-select">
                            <option value="">{% trans "All" %}</option>
                            <option value="QO-100">QO-100</option>
                            <option value="AO-91">AO-91</option>
                            <option value="AO-92">AO-92</option>
                            <option value="SO-50">SO-50</option>
                            <option value="FO-29">FO-29</option>
                            <option value="AO-27">AO-27</option>
                            <option value="ISS">ISS</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="button" class="btn btn-secondary" title="{% trans "Reset" %}">
                            <span>üîÑ</span>
                        </button>
                        <button type="button" class="btn btn-primary" title="{% trans "Apply" %}">
                            <span>üîç</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="section-title"><span>üìä</span> {% trans "Statistics" %}</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th class="text-center">QSO</th>
                                    <th class="text-center">Uniq QSO</th>
                                    <th class="text-center">DXCC</th>
                                    <th class="text-center">–†-150-–°</th>
                                    <th class="text-center">RU Reg</th>
                                    <th class="text-center">CQ Zone</th>
                                    <th class="text-center">ITU Zone</th>
                                    <th class="text-center">Grid</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-center">0</td>
                                    <td class="text-center">0</td>
                                    <td class="text-center">0</td>
                                    <td class="text-center">0</td>
                                    <td class="text-center">0</td>
                                    <td class="text-center">0</td>
                                    <td class="text-center">0</td>
                                    <td class="text-center">0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="col-lg-3">
            <!-- –£—Ç–∏–ª–∏—Ç—ã -->
            <div class="utility-card mb-3">
                <div class="utility-header">
                    <div class="utility-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 0a.5.5 0 0 1 .5.5v.93l4.387 4.388a.5.5 0 0 1-.707.707L8.5 7.03V.5h.5a.5.5 0 0 1 .5.5zM6 8.793 1.354 4.207a.5.5 0 1 1 .708-.708L6 7.586l4.646 4.646a.5.5 0 0 1-.708.708L6 8.793z"/>
                            <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                        </svg>
                    </div>
                    <h6 class="utility-title">{% trans "This is useful!" %}</h6>
                </div>
                <div class="utility-body">
                    <a href="/dashboard/qo100/converter/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-primary">
                            <span>üõ∞Ô∏è</span>
                        </div>
                        <span class="utility-link-text">{% trans "QO-100 Log Converter" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                    <a href="/dashboard/cosmos/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-secondary">
                            <span>üöÄ</span>
                        </div>
                        <span class="utility-link-text">{% trans "Space Diploma Application" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                    <a href="/user-awards/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-info">
                            <span>üèÜ</span>
                        </div>
                        <span class="utility-link-text">{% trans "User Awards" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <!-- QO-100 —Ä–µ–π—Ç–∏–Ω–≥–∏ -->
            <div class="utility-card mb-3">
                <div class="utility-header">
                    <div class="utility-icon" style="background: #264653;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.25-14.75v1.5a.25.25 0 0 1-.5 0v-1.5a.25.25 0 0 1 .5 0zm0 12v1.5a.25.25 0 0 1-.5 0v-1.5a.25.25 0 0 1 .5 0zM4.5 8a.25.25 0 0 1-.25.25h-1.5a.25.25 0 0 1 0-.5h1.5A.25.25 0 0 1 4.5 8zm9.75.25h-1.5a.25.25 0 0 1 0-.5h1.5a.25.25 0 0 1 0 .5z"/>
                        </svg>
                    </div>
                    <h6 class="utility-title">QO-100 {% trans "Ratings" %}</h6>
                </div>
                <div class="utility-body">
                    <a href="/dashboard/qo100/regions/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-warning">
                            <span>üó∫Ô∏è</span>
                        </div>
                        <span class="utility-link-text">{% trans "RF Regions" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                    <a href="/dashboard/qo100/r150s/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-success">
                            <span>üåç</span>
                        </div>
                        <span class="utility-link-text">{% trans "R-150-S Countries" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                    <a href="/dashboard/qo100/dxcc/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-danger">
                            <span>üåê</span>
                        </div>
                        <span class="utility-link-text">{% trans "DXCC Countries" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                    <a href="/dashboard/qo100/grids/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-purple">
                            <span>üìç</span>
                        </div>
                        <span class="utility-link-text">{% trans "Locators" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                    <a href="/dashboard/qo100/unique-callsigns/" class="utility-link">
                        <div class="utility-link-icon bg-gradient-orange">
                            <span>üì°</span>
                        </div>
                        <span class="utility-link-text">{% trans "Unique Callsigns" %}</span>
                        <svg class="utility-link-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <!-- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è LoTW -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">üîÑ {% trans "LoTW Sync" %}</h6>
                </div>
                <div class="card-body">
                    {% if not profile.lotw_user or not profile.lotw_password %}
                        <p class="mb-0 text-warning">
                            <span class="me-2">‚ö†Ô∏è</span>
                            {% trans "LoTW login and password not added" %}
                        </p>
                    {% elif profile.lotw_chk_pass %}
                        <p class="mb-0 text-success">
                            <span class="me-2 text-success">‚úÖ</span>
                            {% trans "LoTW Access" %}
                        </p>
                    {% endif %}

                    {% if profile.lotw_lastsync %}
                        <p class="mb-0 mt-2">
                            <span class="me-2">üìÖ</span>
                            {% trans "Last sync" %}:
                            <small><strong>{{ profile.lotw_lastsync|date:"d.m.Y H:i" }}</strong></small>
                        </p>
                    {% else %}
                        <p class="mb-0 text-muted mt-2">
                            <span class="me-2">‚ùå</span>
                            {% trans "LoTW sync not performed" %}
                        </p>
                    {% endif %}

                    <p class="mb-0 mt-2">
                        <span class="me-2">üí°</span>
                        <small>{% trans "LoTW sync runs automatically once per day." %}</small>
                    </p>

                    <div class="mt-3">
                        <a href="/dashboard/profile/" class="btn btn-outline-primary btn-sm">
                            <span>‚öôÔ∏è</span> {% trans "LoTW Settings" %}
                        </a>
                    </div>
                </div>
            </div>

            <!-- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ ADIF —Ñ–∞–π–ª—ã -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">üìÅ {% trans "My Recent Uploads" %}</h6>
                </div>
                <div class="card-body p-2">
                    {% if adif_uploads %}
                        <div class="list-group list-group-flush">
                            {% for upload in adif_uploads %}
                                <div class="list-group-item px-2 py-2">
                                    <div class="d-flex justify-content-between align-items-start mb-1">
                                        <small class="text-truncate fw-bold max-width-120px">{{ upload.file_name }}</small>
                                        <div class="d-flex align-items-center gap-1">
                                            <span class="badge {% if upload.processed %}bg-success{% else %}bg-warning{% endif %} py-1">
                                                {{ upload.qso_count|default:0 }} QSO
                                            </span>
                                            <button type="button"
                                                    class="btn btn-outline-danger btn-sm p-1"
                                                    title="{% trans "Delete related QSO" %}"
                                                    data-bs-toggle="modal"
                                                    data-bs-backdrop="false"
                                                    onclick="deleteAdifUpload('{{ upload.id }}', '{{ upload.file_name }}')"
                                                    {% if upload.qso_count|default:0 == 0 %}disabled{% endif %}>
                                                <span class="icon-small">üóëÔ∏è</span>
                                            </button>
                                        </div>
                                    </div>
                                    <small class="text-muted d-block">{{ upload.upload_date|date:"d.m.Y H:i" }}</small>
                                    {% if upload.error_message %}
                                        <small class="text-danger">{{ upload.error_message|truncatechars:30 }}</small>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted small mb-0">{% trans "No uploaded files" %}</p>
                    {% endif %}
                </div>
            </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}