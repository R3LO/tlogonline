{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}TLog - –†–µ–π—Ç–∏–Ω–≥{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/qso-tables.css' %}">
<link rel="stylesheet" href="{% static 'css/rating.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="main-container">
        <!-- Header -->
        <div class="logbook-header text-center">
            <h2><span>üèÜ</span> –†–µ–π—Ç–∏–Ω–≥</h2>
            <p class="mb-0 text-white">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</p>
        </div>

        <div class="p-4">
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="filter-card mb-4">
                <h5 class="section-title"><span>üîç</span> –§–∏–ª—å—Ç—Ä—ã</h5>
                <form class="filter-controls" method="GET" action="{% url 'rating_page' %}" id="rating-filter-form">
                    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ -->
                    <input type="hidden" name="active_tab" id="active-tab" value="{{ request.GET.active_tab|default:'regions' }}">
                    <div class="row g-3">
                        <!-- –¢–∏–ø –¥–∏–∞–ø–∞–∑–æ–Ω–∞ -->
                        <div class="col-12">
                            <label class="form-label small mb-2">–î–∏–∞–ø–∞–∑–æ–Ω</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div class="form-check">
                                    <input class="form-check-input filter-radio" type="radio" name="band_type" id="band_all" value="all"
                                           {% if band_type_filter == 'all' %}checked{% endif %}>
                                    <label class="form-check-label" for="band_all">–í—Å–µ</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input filter-radio" type="radio" name="band_type" id="band_hf" value="hf"
                                           {% if band_type_filter == 'hf' %}checked{% endif %}>
                                    <label class="form-check-label" for="band_hf">–ö–í</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input filter-radio" type="radio" name="band_type" id="band_vhf" value="vhf"
                                           {% if band_type_filter == 'vhf' %}checked{% endif %}>
                                    <label class="form-check-label" for="band_vhf">–£–ö–í</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input filter-radio" type="radio" name="band_type" id="band_sat" value="sat"
                                           {% if band_type_filter == 'sat' %}checked{% endif %}>
                                    <label class="form-check-label" for="band_sat">Sat</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input filter-radio" type="radio" name="band_type" id="band_qo100" value="qo100"
                                           {% if band_type_filter == 'qo100' %}checked{% endif %}>
                                    <label class="form-check-label" for="band_qo100">QO-100</label>
                                </div>
                            </div>
                        </div>

                        <!-- LoTW -->
                        <div class="col-12">
                            <label class="form-label small mb-2">LoTW</label>
                            <div class="d-flex gap-3">
                                <div class="form-check">
                                    <input class="form-check-input filter-radio" type="radio" name="lotw" id="lotw_no" value="no"
                                           {% if lotw_filter == 'no' %}checked{% endif %}>
                                    <label class="form-check-label" for="lotw_no">–ù–µ—Ç</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input filter-radio" type="radio" name="lotw" id="lotw_yes" value="yes"
                                           {% if lotw_filter == 'yes' %}checked{% endif %}>
                                    <label class="form-check-label" for="lotw_yes">–î–∞</label>
                                </div>
                            </div>
                        </div>

                    </div>
                </form>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
            <div class="rating-nav mb-4">
                <div class="d-flex flex-wrap gap-2 justify-content-center">
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'regions' or not request.GET.active_tab %}active{% endif %}" data-tab="regions">
                        <span>üó∫Ô∏è</span> –†–µ–≥–∏–æ–Ω—ã –†–æ—Å—Å–∏–∏
                    </button>
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'r150s' %}active{% endif %}" data-tab="r150s">
                        <span>üéØ</span> –°—Ç—Ä–∞–Ω—ã –†-150-–°
                    </button>
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'dxcc' %}active{% endif %}" data-tab="dxcc">
                        <span>üåç</span> –°—Ç—Ä–∞–Ω—ã DXCC
                    </button>
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'cqz' %}active{% endif %}" data-tab="cqz">
                        <span>üåê</span> CQ –∑–æ–Ω—ã
                    </button>
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'ituz' %}active{% endif %}" data-tab="ituz">
                        <span>üì∂</span> ITU –∑–æ–Ω—ã
                    </button>
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'iota' %}active{% endif %}" data-tab="iota">
                        <span>üèùÔ∏è</span> IOTA
                    </button>
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'qth' %}active{% endif %}" data-tab="qth">
                        <span>üìç</span> QTH –ª–æ–∫–∞—Ç–æ—Ä—ã
                    </button>
                    <button type="button" class="btn btn-outline-primary rating-nav-btn {% if request.GET.active_tab == 'callsigns' %}active{% endif %}" data-tab="callsigns">
                        <span>üì°</span> –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–∑—ã–≤–Ω—ã–µ
                    </button>
                </div>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="rating-content">
                <!-- –†–µ–≥–∏–æ–Ω—ã –†–æ—Å—Å–∏–∏ - –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ -->
                <div class="rating-tab {% if request.GET.active_tab == 'regions' or not request.GET.active_tab %}active{% endif %}" id="regions-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üó∫Ô∏è</span> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –†–æ—Å—Å–∏–∏</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if global_regions_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                            <th>–†–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in global_regions_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="callsign-badge">{{ item.my_callsign }}</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">{{ item.unique_states }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üó∫Ô∏è</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ —Ä–µ–≥–∏–æ–Ω–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- –°—Ç—Ä–∞–Ω—ã –†-150-–° - –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ -->
                <div class="rating-tab {% if request.GET.active_tab == 'r150s' %}active{% endif %}" id="r150s-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üéØ</span> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º –†-150-–°</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if global_r150s_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                            <th>–°—Ç—Ä–∞–Ω –†-150-–°</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in global_r150s_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="callsign-badge">{{ item.my_callsign }}</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">{{ item.unique_countries }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üéØ</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ —Å—Ç—Ä–∞–Ω–∞—Ö –†-150-–° –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- –°—Ç—Ä–∞–Ω—ã DXCC -->
                <div class="rating-tab {% if request.GET.active_tab == 'dxcc' %}active{% endif %}" id="dxcc-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üåç</span> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º DXCC (LoTW)</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if global_dxcc_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                            <th>–°—Ç—Ä–∞–Ω DXCC</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in global_dxcc_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="callsign-badge">{{ item.my_callsign }}</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">{{ item.unique_dxcc }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üåç</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ —Å—Ç—Ä–∞–Ω–∞—Ö DXCC –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- CQ –∑–æ–Ω—ã - –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ -->
                <div class="rating-tab {% if request.GET.active_tab == 'cqz' %}active{% endif %}" id="cqz-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üåê</span> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ CQ –∑–æ–Ω–∞–º</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if global_cqz_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                            <th>CQ –∑–æ–Ω</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in global_cqz_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="callsign-badge">{{ item.my_callsign }}</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">{{ item.unique_cqz }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üåê</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ CQ –∑–æ–Ω–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- ITU –∑–æ–Ω—ã - –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ -->
                <div class="rating-tab {% if request.GET.active_tab == 'ituz' %}active{% endif %}" id="ituz-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üì∂</span> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ ITU –∑–æ–Ω–∞–º</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if global_ituz_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                            <th>ITU –∑–æ–Ω</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in global_ituz_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="callsign-badge">{{ item.my_callsign }}</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">{{ item.unique_ituz }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üì∂</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ–± ITU –∑–æ–Ω–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- IOTA - –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ -->
                <div class="rating-tab {% if request.GET.active_tab == 'iota' %}active{% endif %}" id="iota-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üèùÔ∏è</span> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ IOTA</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if global_iota_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                            <th>IOTA</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in global_iota_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="callsign-badge">{{ item.my_callsign }}</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">{{ item.unique_iota }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üèùÔ∏è</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ–± IOTA –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- QTH –ª–æ–∫–∞—Ç–æ—Ä—ã -->
                <div class="rating-tab {% if request.GET.active_tab == 'qth' %}active{% endif %}" id="qth-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üìç</span> QTH –ª–æ–∫–∞—Ç–æ—Ä—ã</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if qth_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–õ–æ–∫–∞—Ç–æ—Ä</th>
                                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ QSO</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in qth_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="badge bg-info text-dark">{{ item.gridsquare }}</span>
                                            </td>
                                            <td>{{ item.count }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üìç</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ QTH –ª–æ–∫–∞—Ç–æ—Ä–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–∑—ã–≤–Ω—ã–µ - –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ -->
                <div class="rating-tab {% if request.GET.active_tab == 'callsigns' %}active{% endif %}" id="callsigns-tab">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span>üì°</span> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –ø–æ–∑—ã–≤–Ω—ã–º</h6>
                        </div>
                        <div class="card-body p-0">
                            {% if global_callsigns_stats %}
                            <div class="table-responsive">
                                <table class="table table-striped mb-0 rating-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                            <th>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑—ã–≤–Ω—ã—Ö</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in global_callsigns_stats %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>
                                                <span class="callsign-badge">{{ item.my_callsign }}</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">{{ item.unique_callsigns }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-5 text-muted">
                                <span style="font-size: 3rem;">üì°</span>
                                <p class="mb-0">–î–∞–Ω–Ω—ã–µ –æ –ø–æ–∑—ã–≤–Ω—ã—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/rating.js' %}"></script>
{% endblock %}
