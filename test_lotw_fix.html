<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è LoTW</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>üß™ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è LoTW</h1>
        
        <div class="alert alert-info">
            <h4>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO</h4>
            <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO –≤ LoTW.</p>
        </div>
        
        <!-- –¢–µ—Å—Ç–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ -->
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                    <th>–î–∏–∞–ø–∞–∑–æ–Ω</th>
                    <th>–†–µ–∂–∏–º</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>2024-01-01</td>
                    <td>TEST_CALL_1</td>
                    <td>20m</td>
                    <td>SSB</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-outline-info view-qso-btn" 
                                data-qso-id="test-id-1" title="–ü—Ä–æ—Å–º–æ—Ç—Ä QSO">
                            <span>üëÅÔ∏è</span>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>2024-01-02</td>
                    <td>TEST_CALL_2</td>
                    <td>40m</td>
                    <td>CW</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-outline-info view-qso-btn" 
                                data-qso-id="test-id-2" title="–ü—Ä–æ—Å–º–æ—Ç—Ä QSO">
                            <span>üëÅÔ∏è</span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="mt-4">
            <button type="button" class="btn btn-primary" onclick="testQSOButtons()">
                üß™ –¢–µ—Å—Ç –∫–Ω–æ–ø–æ–∫ QSO
            </button>
            <button type="button" class="btn btn-secondary" onclick="console.log('–§—É–Ω–∫—Ü–∏—è showQSOModal:', typeof window.showQSOModal)">
                üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO -->
    <div class="modal fade" id="viewQSOModalLotw" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        üìã –î–µ—Ç–∞–ª–∏ QSO
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-3">
                    <div class="row g-3">
                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="col-md-6">
                            <div class="card border-primary h-100">
                                <div class="card-header bg-primary text-white py-2">
                                    <h6 class="mb-0">üìä –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                                </div>
                                <div class="card-body p-3">
                                    <div class="row g-2 small">
                                        <div class="col-5 text-muted">üÜî ID QSO:</div>
                                        <div class="col-7"><span id="view_id" class="badge bg-dark text-light">-</span></div>

                                        <div class="col-5 text-muted">üìÖ –î–∞—Ç–∞:</div>
                                        <div class="col-7"><span id="view_date">-</span></div>
                                        
                                        <div class="col-5 text-muted">üïê –í—Ä–µ–º—è:</div>
                                        <div class="col-7"><span id="view_time">-</span></div>
                                        
                                        <div class="col-5 text-muted">üë§ –ú–æ–π –ø–æ–∑—ã–≤–Ω–æ–π:</div>
                                        <div class="col-7"><span id="view_my_callsign" class="badge bg-primary">-</span></div>
                                        
                                        <div class="col-5 text-muted">üì° –ü–æ–∑—ã–≤–Ω–æ–π:</div>
                                        <div class="col-7"><span id="view_callsign" class="badge bg-success">-</span></div>
                                        
                                        <div class="col-5 text-muted">üì∂ –î–∏–∞–ø–∞–∑–æ–Ω:</div>
                                        <div class="col-7"><span id="view_band" class="badge bg-secondary">-</span></div>
                                        
                                        <div class="col-5 text-muted">üìü –†–µ–∂–∏–º:</div>
                                        <div class="col-7"><span id="view_mode" class="badge bg-info">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="col-md-6">
                            <div class="card border-info h-100">
                                <div class="card-header bg-info text-white py-2">
                                    <h6 class="mb-0">üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                                </div>
                                <div class="card-body p-3">
                                    <div class="row g-2 small">
                                        <div class="col-5 text-muted">üìà –ß–∞—Å—Ç–æ—Ç–∞:</div>
                                        <div class="col-7"><span id="view_frequency" class="text-mono">-</span></div>
                                        
                                        <div class="col-5 text-muted">üì§ RST –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π:</div>
                                        <div class="col-7"><span id="view_rst_sent" class="badge bg-warning">-</span></div>
                                        
                                        <div class="col-5 text-muted">üì• RST –ø—Ä–∏–Ω—è—Ç—ã–π:</div>
                                        <div class="col-7"><span id="view_rst_rcvd" class="badge bg-warning">-</span></div>
                                        
                                        <div class="col-5 text-muted">üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫:</div>
                                        <div class="col-7"><span id="view_sat_name">-</span></div>
                                        
                                        <div class="col-5 text-muted">üì° Prop Mode:</div>
                                        <div class="col-7"><span id="view_prop_mode">-</span></div>
                                        
                                        <div class="col-5 text-muted">üåç DXCC:</div>
                                        <div class="col-7"><span id="view_dxcc" class="badge bg-primary">-</span></div>
                                        
                                        <div class="col-5 text-muted">üèùÔ∏è IOTA:</div>
                                        <div class="col-7"><span id="view_iota">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-2">
                        <!-- –õ–æ–∫–∞—Ü–∏—è -->
                        <div class="col-md-6">
                            <div class="card border-success h-100">
                                <div class="card-header bg-success text-white py-2">
                                    <h6 class="mb-0">üìç –õ–æ–∫–∞—Ü–∏—è</h6>
                                </div>
                                <div class="card-body p-3">
                                    <div class="row g-2 small">
                                        <div class="col-5 text-muted">üéØ –ú–æ–π –ª–æ–∫–∞—Ç–æ—Ä:</div>
                                        <div class="col-7"><span id="view_my_gridsquare" class="badge bg-success">-</span></div>
                                        
                                        <div class="col-5 text-muted">üéØ –õ–æ–∫–∞—Ç–æ—Ä:</div>
                                        <div class="col-7"><span id="view_gridsquare" class="badge bg-success">-</span></div>
                                        
                                        <div class="col-5 text-muted">üåé –ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç:</div>
                                        <div class="col-7"><span id="view_continent">-</span></div>
                                        
                                        <div class="col-5 text-muted">üá∑üá∫ –†–µ–≥–∏–æ–Ω –†–§:</div>
                                        <div class="col-7"><span id="view_state" class="badge bg-warning">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- QSL —Å—Ç–∞—Ç—É—Å -->
                        <div class="col-md-6">
                            <div class="card border-warning h-100">
                                <div class="card-header bg-warning text-dark py-2">
                                    <h6 class="mb-0">üèÜ QSL —Å—Ç–∞—Ç—É—Å</h6>
                                </div>
                                <div class="card-body p-3">
                                    <div class="row g-2 small">
                                        <div class="col-5 text-muted">üìß LoTW:</div>
                                        <div class="col-7"><span id="view_lotw" class="badge bg-info">-</span></div>
                                        
                                        <div class="col-5 text-muted">üìÆ Paper QSL:</div>
                                        <div class="col-7"><span id="view_paper_qsl" class="badge bg-warning">-</span></div>
                                        
                                        <div class="col-5 text-muted">üèÜ R150s:</div>
                                        <div class="col-7"><span id="view_r150s" class="badge bg-success">-</span></div>
                                        
                                        <div class="col-5 text-muted">üìÖ LoTW RXQSL:</div>
                                        <div class="col-7"><span id="view_app_lotw_rxqsl">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer py-2">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        ‚ùå –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ lotw.js –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test LoTW JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            function populateViewModal(qsoData) {
                const fields = {
                    'view_id': qsoData.id || '-',
                    'view_callsign': qsoData.callsign || '-',
                    'view_date': qsoData.date || '-',
                    'view_time': qsoData.time || '-',
                    'view_band': qsoData.band || '-',
                    'view_mode': qsoData.mode || '-',
                    'view_frequency': qsoData.frequency || '-',
                    'view_rst_sent': qsoData.rst_sent || '-',
                    'view_rst_rcvd': qsoData.rst_rcvd || '-',
                    'view_my_callsign': qsoData.my_callsign || '-',
                    'view_my_gridsquare': qsoData.my_gridsquare || '-',
                    'view_gridsquare': qsoData.gridsquare || '-',
                    'view_continent': qsoData.continent || '-',
                    'view_state': qsoData.state || '-',
                    'view_sat_name': qsoData.sat_name || '-',
                    'view_prop_mode': qsoData.prop_mode || '-',
                    'view_dxcc': qsoData.dxcc || '-',
                    'view_iota': qsoData.iota || '-',
                    'view_lotw': qsoData.lotw || '-',
                    'view_paper_qsl': qsoData.paper_qsl || '-',
                    'view_r150s': qsoData.r150s || '-',
                    'view_app_lotw_rxqsl': qsoData.app_lotw_rxqsl || '-'
                };
                
                Object.keys(fields).forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) {
                        element.textContent = fields[fieldId];
                    }
                });
            }
            
            // –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            window.showQSOModal = function(qsoId) {
                console.log('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è QSO ID:', qsoId);
                
                if (!qsoId) {
                    console.error('QSO ID –Ω–µ —É–∫–∞–∑–∞–Ω');
                    alert('QSO ID –Ω–µ —É–∫–∞–∑–∞–Ω');
                    return;
                }
                
                const modal = document.getElementById('viewQSOModalLotw');
                
                if (!modal) {
                    console.error('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ viewQSOModalLotw –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
                    alert('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.');
                    return;
                }
                
                if (typeof bootstrap === 'undefined') {
                    console.error('Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                    alert('Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    return;
                }
                
                try {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    populateViewModal({
                        id: qsoId,
                        callsign: 'TEST_CALL_' + qsoId,
                        date: '2024-01-01',
                        time: '12:00',
                        band: '20m',
                        mode: 'SSB',
                        frequency: '14.200 MHz',
                        rst_sent: '59',
                        rst_rcvd: '59',
                        my_callsign: 'MY_CALL',
                        my_gridsquare: 'JN45',
                        gridsquare: 'LO01',
                        continent: 'EU',
                        ru_region: '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
                        sat_name: 'AO-91',
                        prop_mode: 'SAT',
                        dxcc: '297',
                        iota: 'EU-015',
                        lotw: 'Y',
                        paper_qsl: 'N',
                        r150s: 'N',
                        app_lotw_rxqsl: '2024-01-02 14:30:00'
                    });
                    
                    console.log('–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...');
                    const bsModal = new bootstrap.Modal(modal, {
                        backdrop: true,
                        keyboard: true,
                        focus: true
                    });
                    bsModal.show();
                    
                    console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                    
                    // –£–±–∏—Ä–∞–µ–º backdrop –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
                    const cleanupHandler = function () {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => backdrop.remove());
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        modal.removeEventListener('hidden.bs.modal', cleanupHandler);
                    };
                    
                    modal.addEventListener('hidden.bs.modal', cleanupHandler);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: ' + error.message);
                }
            };
            
            // –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO
            function handleQSOViewClick(event) {
                const button = event.target.closest('.view-qso-btn');
                if (button) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    const qsoId = button.getAttribute('data-qso-id');
                    console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO, ID:', qsoId);
                    
                    if (qsoId) {
                        window.showQSOModal(qsoId);
                    }
                    
                    return false;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–∫–∞ –¢–û–õ–¨–ö–û –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO
            document.addEventListener('click', handleQSOViewClick);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const viewButtons = document.querySelectorAll('.view-qso-btn');
            console.log(`–ù–∞–π–¥–µ–Ω–æ ${viewButtons.length} –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ QSO`);
            
            // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            window.testQSOButtons = function() {
                console.log('=== –¢–ï–°–¢ –ö–ù–û–ü–û–ö QSO ===');
                const buttons = document.querySelectorAll('.view-qso-btn');
                console.log(`–ù–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–æ–∫: ${buttons.length}`);
                
                if (buttons.length > 0) {
                    const firstBtn = buttons[0];
                    const qsoId = firstBtn.getAttribute('data-qso-id');
                    console.log(`–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –∫–Ω–æ–ø–∫—É —Å ID: ${qsoId}`);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    window.showQSOModal(qsoId);
                    console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è');
                }
            };
        });
    </script>
</body>
</html>