<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Ñ–æ—Ä–º—ã —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>–¢–µ—Å—Ç —Ñ–æ—Ä–º—ã —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è</h2>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <form method="post" action="/profile/" id="profile-edit-form">
            <input type="hidden" name="csrfmiddlewaretoken" value="test_token">
            
            <div class="mb-3">
                <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" class="form-control" name="username" value="testuser">
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è (–ù–ï —Ñ–æ—Ä–º–∞!) -->
            <div class="mt-4">
                <button type="button" class="btn btn-warning" data-bs-toggle="collapse" data-bs-target="#password_change_section">
                    üíæ –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                </button>
            </div>
            
            <div class="collapse mt-3" id="password_change_section">
                <div class="card card-body">
                    <h6 class="mb-3">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h6>
                    
                    <div class="mb-3">
                        <label class="form-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="old_password"
                               required autocomplete="current-password">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="new_password"
                               placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤" required
                               autocomplete="new-password" minlength="8">
                        <div class="form-text">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                        <input type="password" class="form-control" id="confirm_password"
                               placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required
                               autocomplete="new-password" minlength="8">
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-warning btn-sm" onclick="changePassword()">
                            <span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm" 
                                data-bs-toggle="collapse" data-bs-target="#password_change_section">
                            <span>‚úñ</span> –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary mt-3">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        </form>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
        window.changePassword = function() {
            const oldPassword = document.getElementById('old_password')?.value.trim();
            const newPassword = document.getElementById('new_password')?.value.trim();
            const confirmPassword = document.getElementById('confirm_password')?.value.trim();

            if (!oldPassword || !newPassword || !confirmPassword) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }

            if (newPassword.length < 8) {
                alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/profile/change-password/';
            form.style.display = 'none';

            // –î–æ–±–∞–≤–ª—è–µ–º CSRF —Ç–æ–∫–µ–Ω
            const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);

            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –ø–∞—Ä–æ–ª–µ–π
            const oldPasswordInput = document.createElement('input');
            oldPasswordInput.type = 'hidden';
            oldPasswordInput.name = 'old_password';
            oldPasswordInput.value = oldPassword;
            form.appendChild(oldPasswordInput);

            const newPasswordInput = document.createElement('input');
            newPasswordInput.type = 'hidden';
            newPasswordInput.name = 'new_password';
            newPasswordInput.value = newPassword;
            form.appendChild(newPasswordInput);

            const confirmPasswordInput = document.createElement('input');
            confirmPasswordInput.type = 'hidden';
            confirmPasswordInput.name = 'confirm_password';
            confirmPasswordInput.value = confirmPassword;
            form.appendChild(confirmPasswordInput);

            document.body.appendChild(form);
            form.submit();
        };
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>